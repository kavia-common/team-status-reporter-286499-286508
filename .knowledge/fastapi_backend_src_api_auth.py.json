{"is_source_file": true, "format": "Python", "description": "This file implements authentication endpoints for a FastAPI backend, including registration, login, token management, and user profile retrieval. It handles JWT token creation, password hashing, and cookie management for refresh tokens.", "external_files": ["src.api.config", "src.api.db", "src.api.models", "src.api.schemas"], "external_methods": ["get_session_factory", "session_scope", "get_engine"], "published": ["router"], "classes": [{"name": "LocalUser", "description": "User model representing local authentication users stored in the database."}], "methods": [{"name": "str _create_jwt_token(subject: str, expires_delta: timedelta)", "description": "Creates a JWT token with specified subject and expiration.", "scope": "", "scopeKind": ""}, {"name": "str _get_access_token(user_id: str)", "description": "Generates an access token for a given user ID with configured expiry.", "scope": "", "scopeKind": ""}, {"name": "str _get_refresh_token(user_id: str)", "description": "Generates a refresh token for a given user ID with configured expiry.", "scope": "", "scopeKind": ""}, {"name": "_set_refresh_cookie(resp: Response, token: str)", "description": "Sets an HttpOnly cookie with the refresh token.", "scope": "", "scopeKind": ""}, {"name": "_clear_refresh_cookie(resp: Response)", "description": "Deletes the refresh token cookie.", "scope": "", "scopeKind": ""}, {"name": "bool _verify_password(plain_password: str, password_hash: str)", "description": "Verifies a plaintext password against its hash.", "scope": "", "scopeKind": ""}, {"name": "str _hash_password(password: str)", "description": "Hashes a plaintext password.", "scope": "", "scopeKind": ""}, {"name": "_init_db()", "description": "Initializes database tables if they do not exist.", "scope": "", "scopeKind": ""}, {"name": "Session _get_db()", "description": "Provides a database session from the session factory.", "scope": "", "scopeKind": ""}, {"name": "TokenResponse register(payload: RegisterRequest, response: Response)", "description": "Handles user registration, creating a new user and returning tokens.", "scope": "", "scopeKind": ""}, {"name": "TokenResponse login(payload: LoginRequest, response: Response)", "description": "Authenticates a user and returns access and refresh tokens.", "scope": "", "scopeKind": ""}, {"name": "str _decode_token(token: str)", "description": "Decodes a JWT token to extract the subject (user ID).", "scope": "", "scopeKind": ""}, {"name": "LocalUser _get_current_user(request: Request)", "description": "Retrieves the currently authenticated user based on the bearer token.", "scope": "", "scopeKind": ""}, {"name": "UserOut me(current_user: Annotated[LocalUser, Depends(_get_current_user)])", "description": "Returns the profile information of the current authenticated user.", "scope": "", "scopeKind": ""}, {"name": "MessageResponse logout(response: Response)", "description": "Clears the refresh token cookie to log out the user.", "scope": "", "scopeKind": ""}, {"name": "TokenResponse refresh(request: Request)", "description": "Issues a new access token given a valid refresh token cookie.", "scope": "", "scopeKind": ""}], "calls": ["session_scope()", "get_session_factory()", "Base.metadata.create_all", "db.query()", "db.flush()", "jwt.encode()", "jwt.decode()", "Response.set_cookie()", "Response.delete_cookie()", "_hash_password()", "_verify_password()", "_create_jwt_token()", "_get_access_token()", "_get_refresh_token()", "_decode_token()"], "search-terms": ["auth endpoint", "JWT token creation", "register user", "login method", "refresh token cookie", "FastAPI auth", "password hashing", "JWT secret", "user profile", "cookie management"], "state": 2, "file_id": 10, "knowledge_revision": 26, "git_revision": "c6784a9b9ac172972d14a17688d908f117d72ee2", "revision_history": [{"21": ""}, {"23": "c6784a9b9ac172972d14a17688d908f117d72ee2"}, {"25": "c6784a9b9ac172972d14a17688d908f117d72ee2"}, {"26": "c6784a9b9ac172972d14a17688d908f117d72ee2"}], "ctags": [{"_type": "tag", "name": "_clear_refresh_cookie", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def _clear_refresh_cookie(resp: Response):$/", "language": "Python", "kind": "function", "signature": "(resp: Response)"}, {"_type": "tag", "name": "_create_jwt_token", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def _create_jwt_token(subject: str, expires_delta: timedelta) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(subject: str, expires_delta: timedelta)"}, {"_type": "tag", "name": "_decode_token", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def _decode_token(token: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(token: str)"}, {"_type": "tag", "name": "_get_access_token", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def _get_access_token(user_id: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(user_id: str)"}, {"_type": "tag", "name": "_get_current_user", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def _get_current_user(request: Request) -> LocalUser:$/", "language": "Python", "typeref": "typename:LocalUser", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "_get_db", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def _get_db() -> Session:$/", "language": "Python", "typeref": "typename:Session", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_get_refresh_token", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def _get_refresh_token(user_id: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(user_id: str)"}, {"_type": "tag", "name": "_hash_password", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def _hash_password(password: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(password: str)"}, {"_type": "tag", "name": "_init_db", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def _init_db():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_set_refresh_cookie", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def _set_refresh_cookie(resp: Response, token: str):$/", "language": "Python", "kind": "function", "signature": "(resp: Response, token: str)"}, {"_type": "tag", "name": "_verify_password", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def _verify_password(plain_password: str, password_hash: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(plain_password: str, password_hash: str)"}, {"_type": "tag", "name": "login", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def login(payload: LoginRequest, response: Response) -> TokenResponse:$/", "language": "Python", "typeref": "typename:TokenResponse", "kind": "function", "signature": "(payload: LoginRequest, response: Response)"}, {"_type": "tag", "name": "logout", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def logout(response: Response) -> MessageResponse:$/", "language": "Python", "typeref": "typename:MessageResponse", "kind": "function", "signature": "(response: Response)"}, {"_type": "tag", "name": "me", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def me(current_user: Annotated[LocalUser, Depends(_get_current_user)]) -> UserOut:$/", "language": "Python", "typeref": "typename:UserOut", "kind": "function", "signature": "(current_user: Annotated[LocalUser, Depends(_get_current_user)])"}, {"_type": "tag", "name": "pwd_context", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "refresh", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def refresh(request: Request) -> TokenResponse:$/", "language": "Python", "typeref": "typename:TokenResponse", "kind": "function", "signature": "(request: Request)"}, {"_type": "tag", "name": "register", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^def register(payload: RegisterRequest, response: Response) -> TokenResponse:$/", "language": "Python", "typeref": "typename:TokenResponse", "kind": "function", "signature": "(payload: RegisterRequest, response: Response)"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/team-status-reporter-286499-286508/fastapi_backend/src/api/auth.py", "pattern": "/^router = APIRouter(prefix=\"\\/auth\", tags=[\"Auth\"])$/", "language": "Python", "kind": "variable"}], "hash": "0b903d71b968d3a1f4f54b6ca6ac32c2", "format-version": 4, "code-base-name": "fastapi_backend", "filename": "fastapi_backend/src/api/auth.py", "fields": [{"name": "pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/auth\", tags=[\"Auth\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}